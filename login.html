<script type="module">
  import { auth, provider } from './firebase-config.js';
  import { 
    signInWithPopup, 
    GoogleAuthProvider,
    signOut 
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  document.getElementById('googleLogin').addEventListener('click', async () => {
    try {
      // Verifica se o Firebase foi inicializado
      if (!auth) {
        throw new Error('Firebase não inicializado');
      }
      
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      
      // Verificação do email autorizado
      const authorizedEmails = [
        'jacson311@gmail.com',
        'xx'
      ];
      
      if (authorizedEmails.includes(user.email)) {
        window.location.href = 'gerar-qrcode.html';
      } else {
        await signOut(auth);
        showError('Apenas administradores podem acessar');
      }
    } catch (error) {
      console.error('Erro detalhado:', error);
      showError(`Falha no login: ${error.code || error.message}`);
      
      // Se for erro de configuração, recarrega a página
      if (error.code === 'auth/configuration-not-found') {
        setTimeout(() => location.reload(), 3000);
      }
    }
  });

  function showError(message) {
    const errorElement = document.getElementById('error-message');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
  }
</script>
